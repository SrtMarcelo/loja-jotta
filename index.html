<!DOCTYPE html>
 <html lang="pt-br">
  <head>
    <link rel="stylesheet" href="index.css">
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Jotta Store | Acesso</title>
     <style>
    </style>
  </head>
<body>
 <div class="background-image"></div>
  <div class="background-overlay"></div>
   <div class="login-card">
     <h2 id="titulo">Jotta Store &trade;</h2>
      <p id="subtitulo">Identifique-se para acessar a loja</p>
        <div class="input-group hidden" id="group-nome">
         <label>Nome Completo</label>
          <input type="text" id="nome" placeholder="Seu nome">
        </div>
      <div class="input-group">
    <label>E-mail</label>
  <input type="email" id="email" placeholder="seu@email.com">
 </div>
<div class="input-group">
 <label>Senha</label>
  <input type="password" id="senha" placeholder="••••••••">
    </div>
      <button class="btn-principal" id="btn-acao" onclick="executarAcao()">Entrar no Sistema</button>
        <br>
         <a class="alternar" id="link-alternar" onclick="toggleTela()">Não tem conta? Cadastre-se aqui</a>
       </div>
      <script>
    let modoCadastro = false;

    function toggleTela() {
        modoCadastro = !modoCadastro;
        const titulo = document.getElementById('titulo');
        const subtitulo = document.getElementById('subtitulo');
        const btnAcao = document.getElementById('btn-acao');
        const link = document.getElementById('link-alternar');
        const groupNome = document.getElementById('group-nome');

        if (modoCadastro) {
            titulo.innerText = "Criar Conta";
            subtitulo.innerText = "Preencha os dados abaixo";
            btnAcao.innerText = "Finalizar Cadastro";
            link.innerText = "Já tem conta? Faça login";
            groupNome.classList.remove('hidden');
        } else {
            titulo.innerText = "Jotta Store";
            subtitulo.innerText = "Identifique-se para acessar a loja";
            btnAcao.innerText = "Entrar no Sistema";
            link.innerText = "Não tem conta? Cadastre-se aqui";
            groupNome.classList.add('hidden');
        }
    }

    async function executarAcao() {
    const email = document.getElementById('email').value;
    const senha = document.getElementById('senha').value;
    const nome = document.getElementById('nome').value;

    // 1. BLOQUEIO DE CAMPOS VAZIOS: Impede de prosseguir se faltar algo
    if (!email || !senha || (modoCadastro && !nome)) {
        alert("⚠️ Por favor, preencha todos os campos antes de continuar.");
        return; // Para a execução aqui
    }

    const urlBase = 'https://marcelo-ferreira-de-jesus.onrender.com'; 
    const rota = modoCadastro ? '/cadastrar' : '/login';

    const corpoDados = modoCadastro 
        ? JSON.stringify({ nome: nome, email: email, senha: senha })
        : JSON.stringify({ email: email, senha: senha });

    try {
        const resposta = await fetch(`${urlBase}${rota}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: corpoDados
        });

        const resultado = await resposta.json();

        if (resposta.ok) {
            alert("✅ " + (modoCadastro ? "Cadastro realizado! Faça login." : "Acesso Autorizado!"));
            // 2. SÓ REDIRECIONA SE TUDO ESTIVER OK
            if (!modoCadastro) {
                window.location.href = "loja.html";
            } else {
                toggleTela();
            }
        } else {
            // Se o servidor responder com erro (senha errada, etc), ele avisa aqui
            alert("❌ " + (resultado.erro || "Dados inválidos. Verifique seu login."));
        }
    } catch (erro) {
        alert("Erro técnico: O servidor não respondeu. Tente novamente em instantes.");
        console.error(erro);
    }
}
</script>
  </body>
</html>